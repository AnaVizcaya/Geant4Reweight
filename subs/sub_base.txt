#!/bin/bash

source /cvmfs/dune.opensciencegrid.org/products/dune/setup_dune.sh
setup ifdhc 
echo "setup"

MYDIR=/dune/app/users/calcuttj/


###MOVE CODE OVER

mkdir ${_CONDOR_SCRATCH_DIR}/myproducts/
mkdir ${_CONDOR_SCRATCH_DIR}/myproducts/.upsfiles
cat > ${_CONDOR_SCRATCH_DIR}/myproducts/.upsfiles/dbconfig << 'EOF'
FILE = DBCONFIG
AUTHORIZED_NODES = *
VERSION_SUBDIR = 1
PROD_DIR_PREFIX = ${UPS_THIS_DB}
UPD_USERCODE_DIR = ${UPS_THIS_DB}/.updfiles
EOF

cd ${_CONDOR_SCRATCH_DIR}/myproducts/
ifdh cp ${MYDIR}/larsoft/build_slf6.x86_64/dunetpc-06.83.00-slf6-x86_64-e15-prof.tar.bz2 ${_CONDOR_SCRATCH_DIR}/myproducts/dunetpc-06.83.00-slf6-x86_64-e15-prof.tar.bz2

tar -jxf dunetpc-06.83.00-slf6-x86_64-e15-prof.tar.bz2
export PRODUCTS=${_CONDOR_SCRATCH_DIR}/myproducts:${PRODUCTS}
unsetup ifdhc
setup -B dunetpc v06_83_00 -q +e15:+prof 


cd ${_CONDOR_SCRATCH_DIR}
mkdir ${_CONDOR_SCRATCH_DIR}/code/
echo ${_CONDOR_SCRATCH_DIR}

cd ${_CONDOR_SCRATCH_DIR}/code/
ifdh cp ${MYDIR}/geant/geant4.10.03.p03-edit/geant4.10.03.p03-install/geant4_new_install.tar ${_CONDOR_SCRATCH_DIR}/code/geant4_new_install.tar
mkdir geant4-install/
ls .
cd geant4-install 
tar -xvf ${_CONDOR_SCRATCH_DIR}/code/geant4_new_install.tar 
ls . 

cd ${_CONDOR_SCRATCH_DIR}/code/
ifdh cp ${MYDIR}/geant/geant4.10.03.p03-edit/geant4.10.03.p03-build/geant4_build.tar ${_CONDOR_SCRATCH_DIR}/code/geant4_build.tar
mkdir geant-build
ls .
cd geant-build
tar -xvf ${_CONDOR_SCRATCH_DIR}/code/geant4_build.tar 
ls . 

cd ${_CONDOR_SCRATCH_DIR}/code/
ifdh cp ${MYDIR}/geant/GeantReweight/G4Sim-build/G4Sim_build.tar ${_CONDOR_SCRATCH_DIR}/code/G4Sim_build.tar
mkdir G4Sim-build 
ls . 
cd G4Sim-build 
tar -xvf ${_CONDOR_SCRATCH_DIR}/code/G4Sim_build.tar 
ls . 

cd ${_CONDOR_SCRATCH_DIR}/code/
ifdh cp ${MYDIR}/geant/GeantReweight/ReweightBase-build/G4Reweight.tar ${_CONDOR_SCRATCH_DIR}/code/G4Reweight.tar
mkdir ReweightBase-build 
ls . 
cd ReweightBase-build 
tar -xvf ${_CONDOR_SCRATCH_DIR}/code/G4Reweight.tar 
ls . 

cd ${_CONDOR_SCRATCH_DIR}/code/
ifdh cp ${MYDIR}/geant/GeantReweight/G4Sim/macros.tar ${_CONDOR_SCRATCH_DIR}/code/macros.tar
mkdir macros
ls .
cd macros
tar -xvf ${_CONDOR_SCRATCH_DIR}/code/macros.tar
ls .


######################

cd ${_CONDOR_SCRATCH_DIR}/code/geant4-install/bin/
source geant4_lite.sh

cd ${_CONDOR_SCRATCH_DIR}/code/G4Sim-build/

./G4Thin -c ${_CONDOR_SCRATCH_DIR}/code/macros/macros/50MeV/50MeV_${PROCESS}_nom.mac -o thin_nom_50MeV_${PROCESS}.root -i 1. -e 1.


ifdh cp thin_nom_50MeV_${PROCESS}.root /pnfs/dune/scratch/users/calcuttj/GeantReweight/Thin/thin_nom_50MeV_${PROCESS}.root 
